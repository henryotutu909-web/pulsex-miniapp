<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>PulseX</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <script src="https://telegram.org/js/telegram-web-app.js"></script>

  <style>
    body {
      margin:0;
      font-family:Arial, sans-serif;
      background: linear-gradient(135deg,#0f172a,#020617);
      color:white;
    }

    .nav {
      display:flex;
      justify-content:space-around;
      padding:10px;
      background:#020617;
    }

    .nav button {
      flex:1;
      margin:4px;
      padding:10px;
      border:none;
      border-radius:10px;
      background:#1e293b;
      color:white;
      cursor:pointer;
    }

    .nav button.active {
      background:#22c55e;
      color:black;
    }

    .page {
      display:none;
      padding:20px;
      animation: fade 0.4s ease-in;
    }

    .page.active {
      display:block;
    }

    @keyframes fade {
      from { opacity:0; transform:translateY(10px); }
      to { opacity:1; transform:translateY(0); }
    }

    .card {
      background:#020617;
      padding:16px;
      border-radius:14px;
      margin-bottom:14px;
      box-shadow:0 0 15px rgba(34,197,94,0.15);
    }

    .big {
      font-size:28px;
      font-weight:bold;
      color:#22c55e;
      animation:pulse 1.5s infinite;
    }

    @keyframes pulse {
      0%{opacity:1;}
      50%{opacity:.6;}
      100%{opacity:1;}
    }

    button.main {
      width:100%;
      padding:14px;
      border:none;
      border-radius:12px;
      background:#22c55e;
      color:black;
      font-size:16px;
      margin-top:10px;
      cursor:pointer;
    }

    input {
      width:100%;
      padding:10px;
      border-radius:8px;
      border:none;
      margin-top:8px;
    }
  </style>
</head>

<body>

<div class="nav">
  <button onclick="show('dash')" class="active">ğŸ  Dashboard</button>
  <button onclick="show('board')">ğŸ† Leaderboard</button>
  <button onclick="show('airdrop')">ğŸª‚ Airdrop</button>
</div>

<!-- DASHBOARD -->
<div id="dash" class="page active">
  <div class="card">
    <div>Points</div>
    <div class="big" id="points">0</div>
    <div>Referrals: <b id="refs">0</b></div>
  </div>

  <button class="main" onclick="claim()">CLAIM</button>
  <div id="status"></div>

  <div class="card">
    <h3>ğŸ¤ Invite Friends</h3>
    <input id="refLink" readonly>
    <button class="main" onclick="copy()">Copy Referral Link</button>
  </div>
</div>

<!-- LEADERBOARD -->
<div id="board" class="page">
  <div class="card">
    <h2>ğŸ† Top Users</h2>
    <div id="leaderboard">Loading...</div>
  </div>
</div>

<!-- AIRDROP -->
<div id="airdrop" class="page">
  <div class="card">
    <h2 class="big">ğŸª‚ Airdrop</h2>
    <p>Coming Soon</p>
    <p>Early users & referrers will receive higher allocation.</p>
    <div style="font-size:40px; text-align:center; animation:pulse 1.5s infinite;">ğŸ‰</div>
  </div>
</div>

<script>
const BACKEND = "https://pulsex-backend-iqcp.onrender.com";

Telegram.WebApp.ready();
Telegram.WebApp.expand();

const uid = Telegram.WebApp.initDataUnsafe?.user?.id;
const uname = Telegram.WebApp.initDataUnsafe?.user?.username;
const ref = Telegram.WebApp.initDataUnsafe?.start_param;

document.getElementById("refLink").value =
  uid ? `https://t.me/pulsex_airdrop_bot?start=${uid}` : "";

function show(id) {
  document.querySelectorAll(".page").forEach(p=>p.classList.remove("active"));
  document.querySelectorAll(".nav button").forEach(b=>b.classList.remove("active"));
  document.getElementById(id).classList.add("active");
  event.target.classList.add("active");
}

async function claim() {
  document.getElementById("status").innerText = "â³ Claiming...";
  const r = await fetch(`${BACKEND}/claim`,{
    method:"POST",
    headers:{ "Content-Type":"application/json" },
    body:JSON.stringify({ user_id:uid, username:uname, referrer_id:ref })
  });
  const d = await r.json();
  document.getElementById("status").innerText =
    d.success ? "âœ… Claimed!" : "â³ Cooldown active";
  loadMe();
  loadBoard();
}

async function loadMe() {
  const r = await fetch(`${BACKEND}/me`,{
    method:"POST",
    headers:{ "Content-Type":"application/json" },
    body:JSON.stringify({ user_id:uid })
  });
  const d = await r.json();
  document.getElementById("points").innerText = d.points;
  document.getElementById("refs").innerText = d.referrals;
}

async function loadBoard() {
  const r = await fetch(`${BACKEND}/leaderboard`);
  const d = await r.json();
  document.getElementById("leaderboard").innerHTML =
    d.map(x=>`${x.rank}. @${x.username} â€” ${x.points}`).join("<br>");
}

function copy(){
  const i=document.getElementById("refLink");
  i.select();document.execCommand("copy");
}

loadMe();
loadBoard();
</script>

</body>
</html>
